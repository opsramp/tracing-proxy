replicaCount: 1
podAnnotations: {}
imagePullSecrets: []

image:
  repository: us-docker.pkg.dev/opsramp-registry/agent-images/trace-proxy
  pullPolicy: Always # use "IfNotPresent" to avoid pulling the image every time
  tag: "latest" # if empty, then defaults to the chart appVersion.

service:
  type: ClusterIP
  port: 9090

# resources:
#   limits:
#     cpu: "4"
#     memory: "8096Mi"
#   requests:
#     cpu: "2"
#     memory: "2048Mi"

nodeSelector: {}

# Trace Proxy config file values
config:
  api: ""
  key: ""
  secret: ""
  tenantId: ""
  dataset: "ds"
  useTls: true
  UseTlsInsecure: false
  sendMetricsToOpsRamp: true
  proxy:
    protocol: ""
    server: ""
    port: ""
    username: ""
    password: ""

logging:
  logFormat: "json" # Accepted values are one of ["logfmt", "json"]
  logOutput: "stdout" # Accepted values are one of["stdout", "stderr"]

metrics:
  list: ['".*"'] # escape the " with ' while specifying values

rules: |-
  SampleRate = 1

  [dataset1]
          Sampler = "DynamicSampler"
          SampleRate = 2
          FieldList = ["request.method","response.status_code"]
          UseTraceLength = true
          AddSampleRateKeyToTrace = true
          AddSampleRateKeyToTraceField = "meta.refinery.dynsampler_key"
          ClearFrequencySec = 60

  [dataset2]
          Sampler = "EMADynamicSampler"
          GoalSampleRate = 2
          FieldList = ["request.method","response.status_code"]
          UseTraceLength = true
          AddSampleRateKeyToTrace = true
          AddSampleRateKeyToTraceField = "meta.refinery.dynsampler_key"
          AdjustmentInterval = 15
          Weight = 0.5
          MaxKeys = 0
          AgeOutValue = 0.5
          BurstMultiple = 2.0
          BurstDetectionDelay = 3

  [dataset3]
          Sampler = "DeterministicSampler"
          SampleRate = 10

  [dataset4]
          Sampler = "RulesBasedSampler"
          CheckNestedFields = false

          [[dataset4.rule]]
                  name = "drop healthchecks"
                  drop = true
                  [[dataset4.rule.condition]]
                          field = "http.route"
                          operator = "="
                          value = "/health-check"

          [[dataset4.rule]]
                  name = "keep slow 500 errors"
                  SampleRate = 1
                  [[dataset4.rule.condition]]
                          field = "status_code"
                          operator = "="
                          value = 500
                  [[dataset4.rule.condition]]
                          field = "duration_ms"
                          operator = ">="
                          value = 1000.789

          [[dataset4.rule]]
                  name = "dynamically sample 200 responses"
                  [[dataset4.rule.condition]]
                          field = "status_code"
                          operator = "="
                          value = 200
                  [dataset4.rule.sampler.EMADynamicSampler]
                          Sampler = "EMADynamicSampler"
                          GoalSampleRate = 15
                          FieldList = ["request.method", "request.route"]
                          AddSampleRateKeyToTrace = true
                          AddSampleRateKeyToTraceField = "meta.refinery.dynsampler_key"
          [[dataset4.rule]]
                  name = "dynamically sample 200 string responses"
                  [[dataset4.rule.condition]]
                          field = "status_code"
                          operator = "="
                          value = "200"
                  [dataset4.rule.sampler.EMADynamicSampler]
                          Sampler = "EMADynamicSampler"
                          GoalSampleRate = 15
                          FieldList = ["request.method", "request.route"]
                          AddSampleRateKeyToTrace = true
                          AddSampleRateKeyToTraceField = "meta.refinery.dynsampler_key"

          [[dataset4.rule]]
                  name = "sample traces originating from a service"
                  Scope = "span"
                  SampleRate = 5
                  [[dataset4.rule.condition]]
                          field = "service name"
                          operator = "="
                          value = "users"
                  [[dataset4.rule.condition]]
                          field = "meta.span_type"
                          operator = "="
                          value = "root"

          [[dataset4.rule]]
                  SampleRate = 10 # default when no rules match, if missing defaults to 10

  [dataset5]

      Sampler = "TotalThroughputSampler"
      GoalThroughputPerSec = 100
      FieldList = "[request.method]"
